<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Dashboard</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="../assets/img/apple-touch-icon.png" rel="apple-touch-icon">
  <link href="../assets/img/favicon.png" rel="icon">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

  <!-- Google Fonts -->
  <link href="https://fonts.gstatic.com" rel="preconnect">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="../assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="../assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="../assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="../assets/vendor/quill/quill.snow.css" rel="stylesheet">
  <link href="../assets/vendor/quill/quill.bubble.css" rel="stylesheet">
  <link href="../assets/vendor/remixicon/remixicon.css" rel="stylesheet">
  <link href="../assets/vendor/simple-datatables/style.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="../assets/css/style.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
</head>

<body>

    <%- include('header') %>
    <%- include('sidebar') %>

  <main id="main" class="main">

    <!-- <div class="pagetitle">
      <h1>Blank Page</h1>
      <nav>
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="/">Home</a></li>
          <li class="breadcrumb-item">Pages</li>
          <li class="breadcrumb-item active">Blank</li>
        </ol>
      </nav>
    </div> -->
    <!-- End Page Title -->

    <section class="section adminDash">
      <h1>Welcome, <%= adminData.username.charAt(0).toUpperCase() + adminData.username.slice(1) %>!</h1>
    </section>


    <!-- <section class="section dashboard">

      <section class="">
        <div class="stat">
          <h3>Active Users</h3>
          <p><%= totalActiveUsers %></p>
        </div>
      </section>
      
      <div class="row">
        
        <div class="col-lg-2 col-md-6">
          <div class="card custom-info-card">
            <div class="card-body d-flex align-items-center justify-content-between">
              <div>
                <h5 class="card-title">Total Bookings</h5>
                <h6 class="card-value"><%= totalBookings %></h6>
              </div>
              <i class="fas fa-bookmark icon"></i>
            </div>
          </div>
        </div>

        
        <div class="col-lg-2 col-md-6">
          <div class="card custom-info-card">
            <div class="card-body d-flex align-items-center justify-content-between">
              <div>
                <h5 class="card-title">Total Complaints</h5>
                <h6 class="card-value"><%= totalComplaints %></h6>
              </div>
              <i class="fas fa-exclamation-triangle icon"></i>
            </div>
          </div>
        </div>

  
        <div class="col-lg-2 col-md-6">
          <div class="card custom-info-card">
            <div class="card-body d-flex align-items-center justify-content-between">
              <div>
                <h5 class="card-title">Total Employees</h5>
                <h6 class="card-value"><%= totalEmployees %></h6>
              </div>
              <i class="fas fa-users icon"></i>
            </div>
          </div>
        </div>

        
        <div class="col-lg-2 col-md-6">
          <div class="card custom-info-card">
            <div class="card-body d-flex align-items-center justify-content-between">
              <div>
                <h5 class="card-title">Total Users</h5>
                <h6 class="card-value"><%= totalUsers %></h6>
              </div>
              <i class="fas fa-user-friends icon"></i>
            </div>
          </div>
        </div>

     
        <div class="col-lg-2 col-md-6">
          <div class="card custom-info-card">
            <div class="card-body d-flex align-items-center justify-content-between">
              <div>
                <h5 class="card-title">Pending Bookings</h5>
                <h6 class="card-value"><%= pendingBookings %></h6>
              </div>
              <i class="fas fa-clock icon"></i>
            </div>
          </div>
        </div>

        
        <div class="col-lg-2 col-md-6">
          <div class="card custom-info-card">
            <div class="card-body d-flex align-items-center justify-content-between">
              <div>
                <h5 class="card-title">Withdrawn Bookings</h5>
                <h6 class="card-value"><%= withdrawnBookings %></h6>
              </div>
              <i class="fas fa-ban icon"></i>
            </div>
          </div>
        </div>

      
        <div class="col-lg-2 col-md-6">
          <div class="card custom-info-card">
            <div class="card-body d-flex align-items-center justify-content-between">
              <div>
                <h5 class="card-title">Completed Bookings</h5>
                <h6 class="card-value"><%= completedBookings %></h6>
              </div>
              <i class="fas fa-check-circle icon"></i>
            </div>
          </div>
        </div>
      </div>
    </section> -->

    <section class="section dashboard">
      <!-- Active Users -->
      <div class="dashboard-stat-container mb-5">
        <div class="dashboard-stat text-center py-4 bg-primary text-white rounded">
          <h3>Active Users</h3>
          <p class="dashboard-stat-value display-4"><%= totalActiveUsers %></p>
        </div>
      </div>

      <div class="row g-4">

        <div class="col-lg-12 col-md-6">
          <div class="card dashboard-card shadow border-primary">
            <div class="card-body text-center">
              <h5 class="dashboard-card-title text-primary">Most Booked Employee</h5>
              <% if (mostBookedEmployee) { %>
                <div class="most-booked-profile">
                  <!-- <img 
                    src="<%= mostBookedEmployee.profilePhoto ? mostBookedEmployee.profilePhoto : '../assets/img/default-profile.png' %>" 
                    alt="Profile" 
                    class="rounded-circle border border-primary mb-3" 
                    style="width: 80px; height: 80px;"> -->
                </div>
                <h6 class="dashboard-card-value fw-bold text-primary">
                  <%= mostBookedEmployee.name.charAt(0).toUpperCase() + mostBookedEmployee.name.slice(1) %>
                </h6>
                <p class="text-muted">Total Bookings: <strong><%= mostBookedEmployee.bookings.length %></strong></p>
                <span class="badge bg-success px-3 py-2">Top Performer</span>
              <% } else { %>
                <h6 class="dashboard-card-value text-muted">N/A</h6>
                <p class="text-muted">Total Bookings: N/A</p>
              <% } %>
            </div>
          </div>
        </div>
        

        <div class="col-lg-12 col-md-6">
          <div class="card dashboard-card shadow border-primary">
            <div class="card-body text-center">
              <h5 class="dashboard-card-title text-primary">5-Star Rated Employees</h5>
              <% if (employeesWithFiveStarRating.length > 0) { %>
                <div class="employee-list d-flex flex-wrap justify-content-center">
                  <% employeesWithFiveStarRating.forEach(employee => { %>
                    <div class="employee-item mb-3 mx-2 p-2 rounded border border-primary shadow-sm">
                      <h6 class="dashboard-card-value employee-name fw-bold text-primary">
                        <%= employee.name.charAt(0).toUpperCase() + employee.name.slice(1) %>
                      </h6>
                      <p class="text-muted"><%= employee.email %></p>
                    </div>
                  <% }) %>
                </div>
              <% } else { %>
                <p class="text-muted">No employees have received a 5-star rating.</p>
              <% } %>
            </div>
          </div>
        </div>

      </div>
      
    
      <!-- Stats Cards -->
      <div class="row g-4">
        
        <!-- Total Bookings -->
        <div class="col-lg-4 col-md-6">
          <div class="card dashboard-card shadow">
            <div class="card-body d-flex align-items-center justify-content-between">
              <div>
                <h5 class="dashboard-card-title">Total Bookings</h5>
                <h6 class="dashboard-card-value text-primary fw-bold"><%= totalBookings %></h6>
              </div>
              <i class="fas fa-bookmark dashboard-icon fs-3 text-primary"></i>
            </div>
          </div>
        </div>
    
        <!-- Total Complaints -->
        <div class="col-lg-4 col-md-6">
          <div class="card dashboard-card shadow">
            <div class="card-body d-flex align-items-center justify-content-between">
              <div>
                <h5 class="dashboard-card-title">Total Complaints</h5>
                <h6 class="dashboard-card-value text-danger fw-bold"><%= totalComplaints %></h6>
              </div>
              <i class="fas fa-exclamation-triangle dashboard-icon fs-3 text-danger"></i>
            </div>
          </div>
        </div>
    
        <!-- Total Employees -->
        <div class="col-lg-4 col-md-6">
          <div class="card dashboard-card shadow">
            <div class="card-body d-flex align-items-center justify-content-between">
              <div>
                <h5 class="dashboard-card-title">Total Employees</h5>
                <h6 class="dashboard-card-value text-success fw-bold"><%= totalEmployees %></h6>
              </div>
              <i class="fas fa-users dashboard-icon fs-3 text-success"></i>
            </div>
          </div>
        </div>

        <div class="col-lg-4 col-md-6">
          <div class="card dashboard-card shadow">
              <div class="card-body d-flex align-items-center justify-content-between">
                <div>
                  <h5 class="dashboard-card-title">Total Users</h5>
                  <h6 class="dashboard-card-value text-success fw-bold"><%= totalUsers %></h6>
                </div>
                <i class="fas fa-user-friends icon fs-3 text-success"></i>
              </div>
            </div>
          </div>
      
          <div class="col-lg-4 col-md-6">
            <div class="card dashboard-card shadow">
              <div class="card-body d-flex align-items-center justify-content-between">
                <div>
                  <h5 class="dashboard-card-title">Pending Bookings</h5>
                  <h6 class="dashboard-card-value text-warning fw-bold"><%= pendingBookings %></h6>
                </div>
                <i class="fas fa-clock icon text-warning"></i>
              </div>
            </div>
          </div>
      
          <div class="col-lg-4 col-md-6">
            <div class="card dashboard-card shadow">
              <div class="card-body d-flex align-items-center justify-content-between">
                <div>
                  <h5 class="dashboard-card-title">Withdrawn Bookings</h5>
                  <h6 class="dashboard-card-value text-danger fw-bold"><%= withdrawnBookings %></h6>
                </div>
                <i class="fas fa-ban icon text-danger"></i>
              </div>
            </div>
          </div>
      
          <div class="col-lg-4 col-md-6">
            <div class="card dashboard-card shadow">
              <div class="card-body d-flex align-items-center justify-content-between">
                <div>
                  <h5 class="dashboard-card-title">Completed Bookings</h5>
                  <h6 class="dashboard-card-value text-success fw-bold"><%= completedBookings %></h6>
                </div>
                <i class="fas fa-check-circle icon text-success"></i>
              </div>
            </div>
          </div>
        </div>

        
        
      </div>
    </section>
    

    <section class="chart">
      <div class="row">
       
        <div class="col-lg-6 col-md-6">
          <div class="card chart1" >
            <div class="card-body">
              <h5 class="card-title">Users vs Employees</h5>
              <div id="userEmployeeChart"></div>
            </div>
          </div>
        </div>
    
       
        <div class="col-lg-6 col-md-6">
          <div class="card chart2">
            <div class="card-body">
              <h5 class="card-title">Bookings Per Month</h5>
              <div id="bookingLineChart"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-6 col-md-6">
        <div class="card chart3">
          <div class="card-body">
            <h5 class="card-title">Employee Ratings</h5>
            <div id="employeeRatingsChart"></div>
          </div>
        </div>
      </div>
    </div>


    </section>
    
    <!-- <section class="chart">
      <div class="row">
        <div class="col-lg-6 col-md-6">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Employee Ratings</h5>
              <div id="employeeRatingsChart"></div> 
            </div>
          </div>
        </div>
      </div>    
    </section> -->

  </main><!-- End #main -->

  <!-- ======= Footer ======= -->
  <footer id="footer" class="footer">
    <!-- <div class="copyright">
      &copy; Copyright <strong><span>NiceAdmin</span></strong>. All Rights Reserved
    </div> -->
    <div class="credits">
      Designed by <a href="#">Anaswara</a>
    </div>
  </footer><!-- End Footer -->

  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="../assets/vendor/apexcharts/apexcharts.min.js"></script>
  <script src="../assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="../assets/vendor/chart.js/chart.umd.js"></script>
  <script src="../assets/vendor/echarts/echarts.min.js"></script>
  <script src="../assets/vendor/quill/quill.min.js"></script>
  <script src="../assets/vendor/simple-datatables/simple-datatables.js"></script>
  <script src="../assets/vendor/tinymce/tinymce.min.js"></script>
  <script src="../assets/vendor/php-email-form/validate.js"></script>

  <!-- Template Main JS File -->
  <script src="../assets/js/main.js"></script>
  
  <script>
    // Data passed from the backend
    var totalUsers = <%= totalUsers %>;
    var totalEmployees = <%= totalEmployees %>;

    // ApexCharts options for the doughnut chart
    var options = {
        series: [totalUsers, totalEmployees],
        chart: {
            type: 'donut',
            width: '100%'
        },
        labels: ['Users', 'Employees'],
        colors: ['#28a745', '#007bff'], // Customize colors as per your design
        responsive: [{
            breakpoint: 480,
            options: {
                chart: {
                    width: 200
                },
                legend: {
                    position: 'bottom'
                }
            }
        }]
    };

    // Create the chart
    var chart = new ApexCharts(document.querySelector("#userEmployeeChart"), options);
    chart.render();

    //2nd chart booking
    // Data for the booking line chart (received from the backend)
    var bookingCounts = <%= JSON.stringify(bookingCounts) %>; // Booking counts per month

    // ApexCharts options for the line chart
    var options = {
        series: [{
            name: "Bookings",
            data: bookingCounts
        }],
        chart: {
            height: 350,
            type: 'line',
            zoom: {
                enabled: false
            }
        },
        dataLabels: {
            enabled: false
        },
        stroke: {
            curve: 'smooth' // Use smooth curve for the line
        },
        title: {
            text: 'Bookings Per Month',
            align: 'left'
        },
        grid: {
            row: {
                colors: ['#f3f3f3', 'transparent'], // alternating row colors
                opacity: 0.5
            },
        },
        xaxis: {
            categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
        }
    };

    // Create the chart and render it
    var chart = new ApexCharts(document.querySelector("#bookingLineChart"), options);
    chart.render();

    //3rd chart rating
    // Use the ratingsData object passed from the backend
    var options = {
    series: [{
        data: [
            // Assuming these values represent the count of each rating type (e.g., Worst, Average, Best)
            1,  // Worst rating count
            2,  // Average rating count
            4   // Best rating count
        ]
    }],
    chart: {
        type: 'bar',
        height: 350
    },
    plotOptions: {
        bar: {
            borderRadius: 4,
            borderRadiusApplication: 'end',
            horizontal: true, // Horizontal bar chart
        }
    },
    dataLabels: {
        enabled: false // Disabling data labels for simplicity
    },
    xaxis: {
        categories: ['Worst', 'Average', 'Best'], // Categories for the ratings
    }
};

var chart = new ApexCharts(document.querySelector("#employeeRatingsChart"), options);
chart.render();

  </script>





</body>

</html>